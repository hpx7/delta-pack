// Auto-generated by DeltaPack - do not edit
using System.Linq;

namespace Generated.Examples
{
    public enum Enum
    {
        ONE = 0,
        TWO = 1,
        THREE = 2,
        FOUR = 3,
        FIVE = 4
    }

    public class InnerInner
    {
        public long Long { get; set; }
        public Enum Enum { get; set; } = Enum.ONE;
        public long Sint32 { get; set; }

        public static InnerInner Default() => new();

        public static InnerInner FromJson(System.Text.Json.JsonElement json)
        {
            return new()
            {
                Long = json.GetProperty("long").GetInt64(),
                Enum = DeltaPack.JsonHelpers.ParseEnum<Enum>(json.GetProperty("enum")),
                Sint32 = json.GetProperty("sint32").GetInt64(),
            };
        }

        public static System.Text.Json.Nodes.JsonObject ToJson(InnerInner obj)
        {
            var result = new System.Text.Json.Nodes.JsonObject();
            result["long"] = obj.Long;
            result["enum"] = obj.Enum.ToString();
            result["sint32"] = obj.Sint32;
            return result;
        }

        public static InnerInner Clone(InnerInner obj)
        {
            return new()
            {
                Long = obj.Long,
                Enum = obj.Enum,
                Sint32 = obj.Sint32,
            };
        }

        public static bool Equals(InnerInner a, InnerInner b)
        {
            return a.Long == b.Long &&
                a.Enum == b.Enum &&
                a.Sint32 == b.Sint32;
        }

        public static byte[] Encode(InnerInner obj)
        {
            var encoder = new DeltaPack.Encoder();
            Encode_(obj, encoder);
            return encoder.ToBuffer();
        }

        internal static void Encode_(InnerInner obj, DeltaPack.Encoder encoder)
        {
            encoder.PushInt(obj.Long);
            encoder.PushEnum((int)obj.Enum, 3);
            encoder.PushInt(obj.Sint32);
        }

        public static byte[] EncodeDiff(InnerInner a, InnerInner b)
        {
            var encoder = new DeltaPack.Encoder();
            EncodeDiff_(a, b, encoder);
            return encoder.ToBuffer();
        }

        internal static void EncodeDiff_(InnerInner a, InnerInner b, DeltaPack.Encoder encoder)
        {
            var changed = !Equals(a, b);
            encoder.PushBoolean(changed);
            if (!changed) return;
            EncodeDiffFields_(a, b, encoder);
        }

        internal static void EncodeDiffFields_(InnerInner a, InnerInner b, DeltaPack.Encoder encoder)
        {
            {
                var changed = !(a.Long == b.Long);
                encoder.PushBoolean(changed);
                if (changed) encoder.PushIntDiff(a.Long, b.Long);
            }
            {
                var changed = !(a.Enum == b.Enum);
                encoder.PushBoolean(changed);
                if (changed) encoder.PushEnumDiff((int)a.Enum, (int)b.Enum, 3);
            }
            {
                var changed = !(a.Sint32 == b.Sint32);
                encoder.PushBoolean(changed);
                if (changed) encoder.PushIntDiff(a.Sint32, b.Sint32);
            }
        }

        public static InnerInner Decode(byte[] buf)
        {
            var decoder = new DeltaPack.Decoder(buf);
            return Decode_(decoder);
        }

        internal static InnerInner Decode_(DeltaPack.Decoder decoder)
        {
            return new()
            {
                Long = decoder.NextInt(),
                Enum = (Enum)decoder.NextEnum(3),
                Sint32 = decoder.NextInt(),
            };
        }

        public static InnerInner DecodeDiff(InnerInner obj, byte[] diff)
        {
            var decoder = new DeltaPack.Decoder(diff);
            return DecodeDiff_(obj, decoder);
        }

        internal static InnerInner DecodeDiff_(InnerInner obj, DeltaPack.Decoder decoder)
        {
            var changed = decoder.NextBoolean();
            if (!changed) return obj;
            return DecodeDiffFields_(obj, decoder);
        }

        internal static InnerInner DecodeDiffFields_(InnerInner obj, DeltaPack.Decoder decoder)
        {
            return new()
            {
                Long = decoder.NextFieldDiff(obj.Long, x => decoder.NextIntDiff(x)),
                Enum = decoder.NextFieldDiff(obj.Enum, x => (Enum)decoder.NextEnumDiff((int)x, 3)),
                Sint32 = decoder.NextFieldDiff(obj.Sint32, x => decoder.NextIntDiff(x)),
            };
        }
    }

    public class Outer
    {
        public System.Collections.Generic.List<bool> Bool { get; set; } = new System.Collections.Generic.List<bool>();
        public float Double { get; set; }

        public static Outer Default() => new();

        public static Outer FromJson(System.Text.Json.JsonElement json)
        {
            return new()
            {
                Bool = json.GetProperty("bool").EnumerateArray().Select(x => DeltaPack.JsonHelpers.ParseBoolean(x)).ToList(),
                Double = json.GetProperty("double").GetSingle(),
            };
        }

        public static System.Text.Json.Nodes.JsonObject ToJson(Outer obj)
        {
            var result = new System.Text.Json.Nodes.JsonObject();
            result["bool"] = new System.Text.Json.Nodes.JsonArray(obj.Bool.Select(x => (System.Text.Json.Nodes.JsonNode?)x).ToArray());
            result["double"] = obj.Double;
            return result;
        }

        public static Outer Clone(Outer obj)
        {
            return new()
            {
                Bool = new System.Collections.Generic.List<bool>(obj.Bool),
                Double = obj.Double,
            };
        }

        public static bool Equals(Outer a, Outer b)
        {
            return a.Bool.Count == b.Bool.Count && a.Bool.Zip(b.Bool).All(pair => pair.First == pair.Second) &&
                DeltaPack.EqualityHelpers.EqualsFloat(a.Double, b.Double);
        }

        public static byte[] Encode(Outer obj)
        {
            var encoder = new DeltaPack.Encoder();
            Encode_(obj, encoder);
            return encoder.ToBuffer();
        }

        internal static void Encode_(Outer obj, DeltaPack.Encoder encoder)
        {
            encoder.PushArray(obj.Bool, x => encoder.PushBoolean(x));
            encoder.PushFloat(obj.Double);
        }

        public static byte[] EncodeDiff(Outer a, Outer b)
        {
            var encoder = new DeltaPack.Encoder();
            EncodeDiff_(a, b, encoder);
            return encoder.ToBuffer();
        }

        internal static void EncodeDiff_(Outer a, Outer b, DeltaPack.Encoder encoder)
        {
            var changed = !Equals(a, b);
            encoder.PushBoolean(changed);
            if (!changed) return;
            EncodeDiffFields_(a, b, encoder);
        }

        internal static void EncodeDiffFields_(Outer a, Outer b, DeltaPack.Encoder encoder)
        {
            {
                var changed = !(a.Bool.Count == b.Bool.Count && a.Bool.Zip(b.Bool).All(pair => pair.First == pair.Second));
                encoder.PushBoolean(changed);
                if (changed) encoder.PushArrayDiff<bool>(a.Bool, b.Bool, (x, y) => x == y, x => encoder.PushBoolean(x), (x, y) => { });
            }
            {
                var changed = !(DeltaPack.EqualityHelpers.EqualsFloat(a.Double, b.Double));
                encoder.PushBoolean(changed);
                if (changed) encoder.PushFloatDiff(a.Double, b.Double);
            }
        }

        public static Outer Decode(byte[] buf)
        {
            var decoder = new DeltaPack.Decoder(buf);
            return Decode_(decoder);
        }

        internal static Outer Decode_(DeltaPack.Decoder decoder)
        {
            return new()
            {
                Bool = decoder.NextArray(() => decoder.NextBoolean()),
                Double = decoder.NextFloat(),
            };
        }

        public static Outer DecodeDiff(Outer obj, byte[] diff)
        {
            var decoder = new DeltaPack.Decoder(diff);
            return DecodeDiff_(obj, decoder);
        }

        internal static Outer DecodeDiff_(Outer obj, DeltaPack.Decoder decoder)
        {
            var changed = decoder.NextBoolean();
            if (!changed) return obj;
            return DecodeDiffFields_(obj, decoder);
        }

        internal static Outer DecodeDiffFields_(Outer obj, DeltaPack.Decoder decoder)
        {
            return new()
            {
                Bool = decoder.NextFieldDiff(obj.Bool, x => decoder.NextArrayDiff<bool>(x, () => decoder.NextBoolean(), x => !x)),
                Double = decoder.NextFieldDiff(obj.Double, x => decoder.NextFloatDiff(x)),
            };
        }
    }

    public class Inner
    {
        public long Int32 { get; set; }
        public InnerInner InnerInner { get; set; } = InnerInner.Default();
        public Outer Outer { get; set; } = Outer.Default();

        public static Inner Default() => new();

        public static Inner FromJson(System.Text.Json.JsonElement json)
        {
            return new()
            {
                Int32 = json.GetProperty("int32").GetInt64(),
                InnerInner = InnerInner.FromJson(json.GetProperty("innerInner")),
                Outer = Outer.FromJson(json.GetProperty("outer")),
            };
        }

        public static System.Text.Json.Nodes.JsonObject ToJson(Inner obj)
        {
            var result = new System.Text.Json.Nodes.JsonObject();
            result["int32"] = obj.Int32;
            result["innerInner"] = InnerInner.ToJson(obj.InnerInner);
            result["outer"] = Outer.ToJson(obj.Outer);
            return result;
        }

        public static Inner Clone(Inner obj)
        {
            return new()
            {
                Int32 = obj.Int32,
                InnerInner = InnerInner.Clone(obj.InnerInner),
                Outer = Outer.Clone(obj.Outer),
            };
        }

        public static bool Equals(Inner a, Inner b)
        {
            return a.Int32 == b.Int32 &&
                InnerInner.Equals(a.InnerInner, b.InnerInner) &&
                Outer.Equals(a.Outer, b.Outer);
        }

        public static byte[] Encode(Inner obj)
        {
            var encoder = new DeltaPack.Encoder();
            Encode_(obj, encoder);
            return encoder.ToBuffer();
        }

        internal static void Encode_(Inner obj, DeltaPack.Encoder encoder)
        {
            encoder.PushInt(obj.Int32);
            InnerInner.Encode_(obj.InnerInner, encoder);
            Outer.Encode_(obj.Outer, encoder);
        }

        public static byte[] EncodeDiff(Inner a, Inner b)
        {
            var encoder = new DeltaPack.Encoder();
            EncodeDiff_(a, b, encoder);
            return encoder.ToBuffer();
        }

        internal static void EncodeDiff_(Inner a, Inner b, DeltaPack.Encoder encoder)
        {
            var changed = !Equals(a, b);
            encoder.PushBoolean(changed);
            if (!changed) return;
            EncodeDiffFields_(a, b, encoder);
        }

        internal static void EncodeDiffFields_(Inner a, Inner b, DeltaPack.Encoder encoder)
        {
            {
                var changed = !(a.Int32 == b.Int32);
                encoder.PushBoolean(changed);
                if (changed) encoder.PushIntDiff(a.Int32, b.Int32);
            }
            InnerInner.EncodeDiff_(a.InnerInner, b.InnerInner, encoder);
            Outer.EncodeDiff_(a.Outer, b.Outer, encoder);
        }

        public static Inner Decode(byte[] buf)
        {
            var decoder = new DeltaPack.Decoder(buf);
            return Decode_(decoder);
        }

        internal static Inner Decode_(DeltaPack.Decoder decoder)
        {
            return new()
            {
                Int32 = decoder.NextInt(),
                InnerInner = InnerInner.Decode_(decoder),
                Outer = Outer.Decode_(decoder),
            };
        }

        public static Inner DecodeDiff(Inner obj, byte[] diff)
        {
            var decoder = new DeltaPack.Decoder(diff);
            return DecodeDiff_(obj, decoder);
        }

        internal static Inner DecodeDiff_(Inner obj, DeltaPack.Decoder decoder)
        {
            var changed = decoder.NextBoolean();
            if (!changed) return obj;
            return DecodeDiffFields_(obj, decoder);
        }

        internal static Inner DecodeDiffFields_(Inner obj, DeltaPack.Decoder decoder)
        {
            return new()
            {
                Int32 = decoder.NextFieldDiff(obj.Int32, x => decoder.NextIntDiff(x)),
                InnerInner = InnerInner.DecodeDiff_(obj.InnerInner, decoder),
                Outer = Outer.DecodeDiff_(obj.Outer, decoder),
            };
        }
    }

    public class Test
    {
        public string String { get; set; } = "";
        public long Uint32 { get; set; }
        public Inner Inner { get; set; } = Inner.Default();
        public float Float { get; set; }

        public static Test Default() => new();

        public static Test FromJson(System.Text.Json.JsonElement json)
        {
            return new()
            {
                String = DeltaPack.JsonHelpers.ParseString(json.GetProperty("string")),
                Uint32 = json.GetProperty("uint32").GetInt64(),
                Inner = Inner.FromJson(json.GetProperty("inner")),
                Float = json.GetProperty("float").GetSingle(),
            };
        }

        public static System.Text.Json.Nodes.JsonObject ToJson(Test obj)
        {
            var result = new System.Text.Json.Nodes.JsonObject();
            result["string"] = obj.String;
            result["uint32"] = obj.Uint32;
            result["inner"] = Inner.ToJson(obj.Inner);
            result["float"] = obj.Float;
            return result;
        }

        public static Test Clone(Test obj)
        {
            return new()
            {
                String = obj.String,
                Uint32 = obj.Uint32,
                Inner = Inner.Clone(obj.Inner),
                Float = obj.Float,
            };
        }

        public static bool Equals(Test a, Test b)
        {
            return a.String == b.String &&
                a.Uint32 == b.Uint32 &&
                Inner.Equals(a.Inner, b.Inner) &&
                DeltaPack.EqualityHelpers.EqualsFloat(a.Float, b.Float);
        }

        public static byte[] Encode(Test obj)
        {
            var encoder = new DeltaPack.Encoder();
            Encode_(obj, encoder);
            return encoder.ToBuffer();
        }

        internal static void Encode_(Test obj, DeltaPack.Encoder encoder)
        {
            encoder.PushString(obj.String);
            encoder.PushInt(obj.Uint32);
            Inner.Encode_(obj.Inner, encoder);
            encoder.PushFloat(obj.Float);
        }

        public static byte[] EncodeDiff(Test a, Test b)
        {
            var encoder = new DeltaPack.Encoder();
            EncodeDiff_(a, b, encoder);
            return encoder.ToBuffer();
        }

        internal static void EncodeDiff_(Test a, Test b, DeltaPack.Encoder encoder)
        {
            var changed = !Equals(a, b);
            encoder.PushBoolean(changed);
            if (!changed) return;
            EncodeDiffFields_(a, b, encoder);
        }

        internal static void EncodeDiffFields_(Test a, Test b, DeltaPack.Encoder encoder)
        {
            {
                var changed = !(a.String == b.String);
                encoder.PushBoolean(changed);
                if (changed) encoder.PushStringDiff(a.String, b.String);
            }
            {
                var changed = !(a.Uint32 == b.Uint32);
                encoder.PushBoolean(changed);
                if (changed) encoder.PushIntDiff(a.Uint32, b.Uint32);
            }
            Inner.EncodeDiff_(a.Inner, b.Inner, encoder);
            {
                var changed = !(DeltaPack.EqualityHelpers.EqualsFloat(a.Float, b.Float));
                encoder.PushBoolean(changed);
                if (changed) encoder.PushFloatDiff(a.Float, b.Float);
            }
        }

        public static Test Decode(byte[] buf)
        {
            var decoder = new DeltaPack.Decoder(buf);
            return Decode_(decoder);
        }

        internal static Test Decode_(DeltaPack.Decoder decoder)
        {
            return new()
            {
                String = decoder.NextString(),
                Uint32 = decoder.NextInt(),
                Inner = Inner.Decode_(decoder),
                Float = decoder.NextFloat(),
            };
        }

        public static Test DecodeDiff(Test obj, byte[] diff)
        {
            var decoder = new DeltaPack.Decoder(diff);
            return DecodeDiff_(obj, decoder);
        }

        internal static Test DecodeDiff_(Test obj, DeltaPack.Decoder decoder)
        {
            var changed = decoder.NextBoolean();
            if (!changed) return obj;
            return DecodeDiffFields_(obj, decoder);
        }

        internal static Test DecodeDiffFields_(Test obj, DeltaPack.Decoder decoder)
        {
            return new()
            {
                String = decoder.NextFieldDiff(obj.String, x => decoder.NextStringDiff(x)),
                Uint32 = decoder.NextFieldDiff(obj.Uint32, x => decoder.NextIntDiff(x)),
                Inner = Inner.DecodeDiff_(obj.Inner, decoder),
                Float = decoder.NextFieldDiff(obj.Float, x => decoder.NextFloatDiff(x)),
            };
        }
    }
}
